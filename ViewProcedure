CREATE VIEW AlbunsMusicas AS
SELECT 
    M.Nome AS nomeMusica,
    A.Nome AS nomeArtista,
    AL.Nome AS nomeAlbum,
    AL.CapaAlbum,
    AL.CodArtista,
    M.CodMusica
FROM ALBUM AS AL
INNER JOIN Musica AS M ON M.CodAlbum = AL.CodAlbum
INNER JOIN Artista AS A ON A.CodArtista = AL.CodArtista
ORDER BY AL.Nome ASC, M.Nome ASC;

DELIMITER // 

CREATE PROCEDURE ApagarPlaylistsUser(IN codUserParam INT)
BEGIN
	START TRANSACTION;
    
	CREATE TABLE IF NOT EXISTS TempDeletePlaylist(codPlaylist INT);
    
    INSERT INTO TempDeletePlaylist (codPlaylist)
    SELECT CodPlaylist
    FROM PlaylistUsuario
    WHERE CodUser = codUserParam;
    
    DELETE FROM playlistusuario WHERE CodUser = codUserParam;
    
	DELETE FROM PlaylistMusica
    WHERE CodPlaylist IN (SELECT CodPlaylist FROM TempDeletePlaylist);
    
    DELETE FROM Playlist
    WHERE CodPlaylist IN (SELECT CodPlaylist FROM TempDeletePlaylist);

	DROP TABLE TempDeletePlaylist;
    COMMIT;
END //

#DELIMITER;

CREATE VIEW MusicaNavegar AS
SELECT 
    Musica.Nome AS NomeMusica,
    Artista.Nome AS NomeArtista,
    Album.Nome AS NomeAlbum,
    Genero.Nome AS NomeGenero
FROM Musica
JOIN Album AS AL ON Musica.CodAlbum = AL.CodAlbum
JOIN ArtistaMusica AS AM ON Musica.CodMusica = AM.CodMusica
JOIN Artista AS A ON AM.CodArtista = A.CodArtista
JOIN MusicaGenero AS MG ON Musica.CodMusica = MG.CodMusica
JOIN Genero AS G ON MG.CodGenero = G.CodGenero;
